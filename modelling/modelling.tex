\graphicspath{{modelling/fig/}}
{
\tikzset{external/figure name/.add={modelling/}{}}

\chapter{Modelling}
\label{chap:modelling}

\paragraph
In this chapter, mathematical models of a multirotor with a suspended payload will be derived.
These models will be used to simulate the multirotor system in subsequent chapters.
The models will be based on the real multirotor named \emph{Honeybee}, which was built by \cite{Grobler2020} and will be described further in Chapter~\ref{chap:exp_design}.

% ?? Write this section

\paragraph
Firstly, 
quadrotor modelled separately
payload modelled separately
% The system identification and control system techniques in later chapters will then be explained based on the \gls{2D} model to avoid unnecessary complexity.
Finally, it will be described how this model and the techniques in later chapters are extended to the 3D case.
This 3D mathematical model will be used in a non-linear simulation of a multirotor and suspended payload.

% ?? For good modelling of multirotor, survey: https://arxiv.org/pdf/2011.11104.pdf

\FloatBarrier\section{Coordinate frames}

    \paragraph
    A quadrotor with a standard X-configuration is considered in this work.
    Figure~\ref{fig:coord_frames} shows a quadrotor schematic and two coordinate frames that will be used to describe this system.
    
    \begin{figure}[htb]
        \centering
        \includegraphics[width=0.6\linewidth]{modelling/fig/coord_frames}
        \caption{Inertial and body coordinate frames of a quadrotor from \cite{Erasmus2020}}
        \label{fig:coord_frames}
    \end{figure}

    \paragraph
    The inertial frame is denote by $ \mathcal{I} = \{ \bm{\bar{x}}_\mathcal{I}, \bm{\bar{y}}_\mathcal{I}, \bm{\bar{z}}_\mathcal{I} \} $ and describes a \gls{NED} axis system.
    The $x$, $y$, and $z$ axis, align with the North, East, and Down inertial directions respectively.
    The inertial frame assumes a flat, non-rotating earth, since the quadrotor will travel small distances in comparison to the curvature of the earth.
    The origin of this frame is fixed at the takeoff location of the multirotor.

    \paragraph
    The body frame is denote by $ \mathcal{B} = \{ \bm{\bar{x}}_\mathcal{B}, \bm{\bar{y}}_\mathcal{B}, \bm{\bar{z}}_\mathcal{B} \} $ and is fixed to the quadrotor body.
    The origin of this frame is at the \gls{CoM} of the vehicle and the $x$, $y$, and $z$ axis, align with the forwards, rightwards, and downwards directions of the quadrotor body respectively.
    The body frame is defined by a translation and rotation relative to the inertial frame.
    The position of the \gls{CoM} of the multirotor in the inertial frame is denoted as $P = [P_N~~P_E~~P_D]^T$. 
    This represents the translation of the body frame relative to the inertial frame.
    The rotations will be discussed in the section below.

\FloatBarrier\section{Rotations}
    
    \paragraph
    The rotation of the body frame relative to the inertial frame is referred to as the attitude of the multirotor.
    Attitude will be defined in terms of Euler angles or quaternions in this work, which will be described below.

    \FloatBarrier\subsection{Euler angles}

        \paragraph
        Euler angles are a popular way of describing a \gls{3D} rotation as a sequence of three consecutive elementary rotations \cite{Brescianini2013}.
        For aircraft applications, the ZYX-sequence is common \cite{Brescianini2013} and will be used in this work.
        The order of rotations are:
        \begin{enumerate}
            \item Rotate the body frame about the $z$-axis by the yaw angle, $\Psi$.
            \item Rotate the resulting frame about the new $y$-axis by the pitch angle, $\Theta$.
            \item Rotate the resulting frame about the new $x$-axis by the roll angle, $\Phi$.
        \end{enumerate}

        \begin{figure}[!htbp]
            \centering
            \vspace{0.5cm}
            \def\svgwidth{\columnwidth}
            \scalebox{0.85}{\input{modelling/fig/Euler_rotations.pdf_tex}}
            \vspace{0.5cm}
            \caption{Illustration of Euler angles from \cite{Slabber2020}}
            \label{fig:Euler_rotations}
        \end{figure}

        \paragraph
        Figure~\ref{fig:Euler_rotations} gives a simple illustration of the Euler-ZYX angles.
        Note that $\Theta$ and $\Phi$ are each illustrated here as a pure pitch angle and roll angle from the the inertial frame, without a prior Euler rotation.

    \FloatBarrier\subsection{Quaternions}

        \paragraph
        A quaternion provides way of representing a rotation with four parameters.
        An advantage of quaternions is that it does not produce singularities like Euler angles do \cite{Brescianini2013}.
        A quaternion defines a rotation with a single rotation about a fixed axis, 
        which is parametrized by a rotation angle, $\alpha$, and a unit vector, $\vec{r}$.
        A unit quaternion is therefore defined as,
        \begin{equation}
            \bm{q} = [q_0~~q_1~~q_2~~q_3]^T = 
            \begin{bmatrix}
                q_0 \\ 
                \bm{q}_v
            \end{bmatrix}
            =
            \begin{bmatrix}
                \cos(\frac{\alpha}{2}) \\ 
                \vec{r} \sin(\frac{\alpha}{2} )
            \end{bmatrix} ,
        \end{equation}
        where $q_0$ is the magnitude component and $\bm{q}_v$ is the vector component of the quaternion.

        \paragraph
        A Euler-ZYX angle representation, $[\Theta~~\Phi~~\Psi]$, can be converted to a quaternion with the equation \cite{Brescianini2013},
        \begin{equation}
            \bm{q}(\Theta, \Phi, \Psi) = 
            \left[\begin{array}{c}
                \begin{aligned}%[t]
                     \cos{\tfrac{\Phi}{2}} \cos{\tfrac{\Theta}{2}}  \cos{\tfrac{\Psi}{2}}    ~~ &+ ~~ \sin{\tfrac{\Phi}{2}}   \sin{\tfrac{\Theta}{2}}  \sin{\tfrac{\Psi}{2}} \\
                    -\cos{\tfrac{\Phi}{2}} \sin{\tfrac{\Theta}{2}}  \sin{\tfrac{\Psi}{2}}    ~~ &+ ~~ \cos{\tfrac{\Theta}{2}} \cos{\tfrac{\Psi}{2}}    \sin{\tfrac{\Phi}{2}} \\
                     \cos{\tfrac{\Phi}{2}} \cos{\tfrac{\Psi}{2}}    \sin{\tfrac{\Theta}{2}}  ~~ &+ ~~ \sin{\tfrac{\Phi}{2}}   \cos{\tfrac{\Psi}{2}}    \sin{\tfrac{\Psi}{2}} \\
                     \cos{\tfrac{\Phi}{2}} \cos{\tfrac{\Theta}{2}}  \sin{\tfrac{\Psi}{2}}    ~~ &- ~~ \sin{\tfrac{\Phi}{2}}   \cos{\tfrac{\Psi}{2}}    \sin{\tfrac{\Theta}{2}} \\
                \end{aligned}
            \end{array}\right] .
        \end{equation}

        \paragraph
        The inverse of an quaternion is defined as,
        \begin{equation}
            \bm{q}^{-1} = 
            \frac{ \begin{bmatrix} q_0 \\ -\bm{q}_v \end{bmatrix} }{ \sqrt{ {q_{0}}^{2} + {q_{1}}^{2} + {q_{2}}^{2} + {q_{3}}^{2} } } .
        \end{equation}

        \paragraph
        Furthermore, the multiplication of two quaternions, $\bm{q}$ and $\bm{q}^\prime$, is given by \cite{Brescianini2013}:
        \begin{equation}
            \bm{q} \cdot \bm{q}^\prime
            =
            Q( \bm{q} ) \bm{q}^\prime,
        \end{equation}
        where
        \begin{equation}
            Q( \bm{q} ) = 
            \left[\begin{array}{cccc}
                q_{0} &           - q_{1} &           - q_{2} &           - q_{3} \\
                q_{1} & \phantom{-} q_{0} &           - q_{3} & \phantom{-} q_{2} \\
                q_{2} & \phantom{-} q_{3} & \phantom{-} q_{0} &           - q_{1} \\
                q_{3} &           - q_{2} & \phantom{-} q_{1} & \phantom{-} q_{0}
            \end{array}\right] .
        \end{equation}

        \paragraph
        These equations will be applied in subsequent chapters.

\FloatBarrier\section{Quadrotor model}

    \paragraph
    The quadrotor is modelled as a rigid body with six degrees of freedom.
    This includes three translations and three rotational degrees of freedom.
    This quadrotor modelling process is well described by \cite{Erasmus2020} and \cite{Slabber2020}, and the same general procedure is followed in this work. 
    
    \paragraph
    The system parameters describing the physical properties of the quadrotor is listed in Table~\ref{tbl:quadrotor_params}.
    These parameters will be used in subsequent sections to derive a model of the quadrotor.

    \begin{table}[!htbp]
        \renewcommand{\arraystretch}{1.1}
        \centering
        \caption{System parameters of the quadrotor model.}
        \begin{tabularx}{0.66\linewidth}{@{}ll@{}}
            \toprule
            \textbf{Symbol}   & \textbf{Description} \\
                $m_Q$       & Mass of multirotor \\
                $I_{xx}$    & Mass moment of inertia about $\bm{\bar{x}}_\mathcal{B}$ \\ 
                $I_{yy}$    & Mass moment of inertia about $\bm{\bar{y}}_\mathcal{B}$ \\ 
                $I_{zz}$    & Mass moment of inertia about $\bm{\bar{z}}_\mathcal{B}$ \\ 
                $d$         & Distance from \gls{CoM} to each motor\\
                $R_N$       & Virtual yaw moment arm \\
                $\tau$      & Motor-propeller pair time constant \\ 
                $C_{Q_X}$   & Aerodynamic drag coefficient in $\bm{\bar{x}}_\mathcal{B}$ direction \\
                $C_{Q_Y}$   & Aerodynamic drag coefficient in $\bm{\bar{x}}_\mathcal{B}$ direction \\
                $C_{Q_Z}$   & Aerodynamic drag coefficient in $\bm{\bar{x}}_\mathcal{B}$ direction \\
            \bottomrule
        \end{tabularx}
        \label{tbl:quadrotor_params}
    \end{table}

    % ?? Insert light rule under headings

    \paragraph
    The inertia tensor of the quadrotor is defined as,
    \begin{equation} \label{eq:inertia}
        \bm{I_Q} = 
        \begin{bmatrix}
            I_{xx} & I_{xy} & I_{xz}\\
            I_{yx} & I_{yy} & I_{yz}\\
            I_{zx} & I_{zy} & I_{zz}
        \end{bmatrix}
        \approx
        \begin{bmatrix}
            I_{xx} & 0 & 0\\
            0 & I_{yy} & 0\\
            0 & 0 & I_{zz}
        \end{bmatrix}.
    \end{equation}
    The quadrotor is assumed to be symmetrical about the $XZ$- and $YZ$-plane, therefore the inertia tensor can be approximated as a diagonal matrix as shown in Equation~\ref{eq:inertia}. 


    \paragraph
    The linear velocity and angular velocity of the quadrotor with respect to the body frame is denoted by,
    \begin{align}
        \bm{V_\mathcal{B}}          &= 
        \begin{bmatrix}
            V_{\mathcal{B}_X} & V_{\mathcal{B}_Y} & V_{\mathcal{B}_Z}\\
        \end{bmatrix}^T , \mbox{ and} \\
        \bm{\varOmega_\mathcal{B}}  &= 
        \begin{bmatrix}
            \varOmega_{\mathcal{B}_X} & \varOmega_{\mathcal{B}_Y} & \varOmega_{\mathcal{B}_Z}\\
        \end{bmatrix}^T.
    \end{align}
    Furthermore, the sum of forces and sum of moments acting on the quadrotor in the body frame are denotes by,
    \begin{align}
        \bm{F_\mathcal{B}} = &
        \begin{bmatrix}
            F_{\mathcal{B}_X} & F_{\mathcal{B}_Y} & F_{\mathcal{B}_Z} \\
        \end{bmatrix}^T , \mbox{ and}\\
            \bm{M_\mathcal{B}} = &
        \begin{bmatrix}
            M_{\mathcal{B}_X} & M_{\mathcal{B}_Y} & M_{\mathcal{B}_Z} \\
        \end{bmatrix}^T .
    \end{align}

    \paragraph
    As described by \cite{Erasmus2020}, these equations can be used with Newton's second law to derive the rigid body equations of motion as,
    \begin{align}
        \bm{F_\mathcal{B}} & = m_Q\bm{\dot{V}_\mathcal{B}} + \bm{\varOmega_\mathcal{B}} \times m_Q\bm{V_\mathcal{B}} , \label{eq:forces} \\ 
        \bm{M_\mathcal{B}} & = \bm{I_Q}\bm{\dot{\varOmega}_\mathcal{B}} + \bm{\varOmega_\mathcal{B}} \times  \bm{I_Q}\bm{V_\mathcal{B}} , \label{eq:body_rates}
    \end{align}

    \paragraph
    This provides a set of \glspl{ODE} which fully describe the quadrotor motion in six degrees of freedom, given the forces and moments acting on the vehicle.
    With the equation derived by \cite{Schaub2017}, the attitude of the quadrotor can be obtained as a quaternion from the body angular rates using,
    \begin{equation}
        \begin{bmatrix}
            \dot{q}_0 \\
            \dot{q}_1 \\
            \dot{q}_2 \\
            \dot{q}_3
        \end{bmatrix}
        = 
        \frac{1}{2}
        \begin{bmatrix}
            q_{0} &           - q_{1} &           - q_{2} &           - q_{3} \\
            q_{1} & \phantom{-} q_{0} &           - q_{3} & \phantom{-} q_{2} \\
            q_{2} & \phantom{-} q_{3} & \phantom{-} q_{0} &           - q_{1} \\
            q_{3} &           - q_{2} & \phantom{-} q_{1} & \phantom{-} q_{0}
        \end{bmatrix} 
        \begin{bmatrix}
            0 \\
            \varOmega_{\mathcal{B}_X} \\ 
            \varOmega_{\mathcal{B}_Y} \\ 
            \varOmega_{\mathcal{B}_Z}
        \end{bmatrix}.
    \end{equation}

    \paragraph
    The \gls{DCM} is also derived by \cite{Schaub2017} and can be calculated from the attitude quaternion as,
    \begin{equation}
        \bm{R}_{V}=\left[\begin{array}{ccc}
        q_{0}^{2}+q_{1}^{2}+q_{2}^{2}+q_{3}^{2} & 2\left(q_{1} q_{2}+q_{0} q_{3}\right) & 2\left(q_{1} q_{3}-q_{0} q_{2}\right) \\
        2\left(q_{1} q_{2}-q_{0} q_{3}\right) & q_{0}^{2}-q_{1}^{2}+q_{2}^{2}-q_{3}^{2} & 2\left(q_{2} q_{3}+q_{0} q_{1}\right) \\
        2\left(q_{1} q_{3}+q_{0} q_{2}\right) & 2\left(q_{2} q_{3}-q_{0} q_{1}\right) & q_{0}^{2}-q_{1}^{2}-q_{2}^{2}+q_{3}^{2}
        \end{array}\right] .
    \end{equation}
    $\bm{R}_{V}$ is the transformation matrix that describes the rotation from the body frame to the inertial frame such that,
    \begin{equation}
        \bm{V}_{\mathcal{I}} = \bm{R}_{V}^{-1} \bm{V}_{\mathcal{B}}
    \end{equation}

    \paragraph
    Starting at a specified initial condition, Equation~\ref{eq:forces} and Equation~\ref{eq:body_rates} can now be solved with an \gls{ODE} solver in a simulation environment like Simulink to describe the motion of the quadrotor.
    The forces and moments acting on the quadrotor will be described in the next section.
 
\FloatBarrier\section{Forces and moments}

    \paragraph
    Different phenomena apply forces and moments to quadrotor during flight.
    The sum of the forces and sum of moments acting on the quadrotor in the body frame are given by,
    \begin{align}
        \bm{F}_\mathcal{B} &= \bm{F}_\mathcal{B}^T + \bm{F}_\mathcal{B}^A + \bm{F}_\mathcal{B}^G + \bm{F}_\mathcal{B}^P \mbox{ and}\\
        \bm{M}_\mathcal{B} &= \bm{M}_\mathcal{B}^T + \bm{M}_\mathcal{B}^A + \bm{M}_\mathcal{B}^G + \bm{M}_\mathcal{B}^P.
    \end{align}
    The phenomena that cause the different forces and moments are denoted by the subscripts, T, A, G, and P, which refer to actuator thrust, aerodynamic drag, gravity, and the payload respectively. 
    These phenomena are also considered and modelled by \cite{Erasmus2020} and \cite{Slabber2020}.    

    \paragraph
    \textbf{Actuator thrust} \newline
    A quadrotor has four rotors which each produce a thrust as shown in Figure~\ref{fig:coord_frames}.
    However the actuators collectively apply a force, $\bm{F}_\mathcal{B}^T$, 
    and moment, $\bm{M}_\mathcal{B}^T$, to the vehicle.
    This force and moment can be represented in terms of virtual actuator thrusts as,
    \begin{equation} \label{eq:thurst_force_moment}
        \bm{F}_{\mathcal{B}}^T = 
        \begin{bmatrix}
            0\\
            0\\
            \delta_T
        \end{bmatrix} \mbox{~~and~~}
        \bm{M}_{\mathcal{B}}^T = 
        \begin{bmatrix}
            d \cdot \delta_A \\
            d \cdot \delta_E \\
            R_N \cdot \delta_R
        \end{bmatrix} ,
    \end{equation}
    where $d$ is the distance from each motor to the \gls{CoM} of the quadrotor and $R_N$ is the virtual yaw moment arm and is a property of the motor-propeller configuration.
    The virtual aileron, elevator, and rudder actuator thrusts are denoted by $d \delta_T$, $d \delta_A$, $d \delta_E$, and $d \delta_R$, respectively.
    These values are calculated with a mixing matrix, such that,
    \begin{equation} \label{eq:mixing_matrix}
            \begin{bmatrix}
            \delta_T\\
            \delta_A\\
            \delta_E\\
            \delta_R
        \end{bmatrix} = 
        \begin{bmatrix*}[c]
            1 & 1 & 1 & 1\\
            -\frac{1}{\sqrt{2}} & \frac{1}{\sqrt{2}} & \frac{1}{\sqrt{2}} & -\frac{1}{\sqrt{2}}\\
            \frac{1}{\sqrt{2}} & -\frac{1}{\sqrt{2}} & \frac{1}{\sqrt{2}} & -\frac{1}{\sqrt{2}}\\
            1 & 1 & -1 & -1
        \end{bmatrix*}
        \begin{bmatrix}
            T_1\\
            T_2\\
            T_3\\
            T_4
        \end{bmatrix} ,
    \end{equation}
    where $\bm{T} = [T_1~~T_2~~T_3~~T_4]^T$ is a vector of actual thrust forces produced by the four individual rotors.
    Each motor-propeller pair receives a thrust setpoint and produces a corresponding thrust.
    This is modelled with a first order differential equation given by,
    \begin{equation}
        \dot{\bm{T}} = \frac{ \bm{T}_{sp} - \bm{T} }{ \tau } ,
    \end{equation}
    where $\bm{T}_{sp}$ is a vector of thrust setpoints corresponding to $\bm{T}$, and $\tau$ is the time constant of the motor-propeller pair.
        
    \paragraph
    \textbf{Aerodynamics} \newline
    Multirotors experience aerodynamic forces due to the relative velocity of air over the vehicle.
    The aerodynamic model is based on work done by \cite{Moller2015} and is also applied successfully by \cite{Erasmus2020} and \cite{Slabber2020}.
    The model describes the aerodynamic forces as,
    \begin{equation} \label{eq:drag_quad}
        \bm{F}_\mathcal{B}^A = \frac{1}{2}   \rho   \bm{V}_{\mathcal{B}_{w}} |\bm{V}_{\mathcal{B}_{w}}|   \bm{C}_Q
    \end{equation}
    where $\rho$ is the air density, 
    \(\bm{V}_{\mathcal{B}_{w}}\) is the relative velocity of air over the quadrotor in the body frame, 
    and $\bm{C}_Q = [C_{Q_X}~~C_{Q_Y}~~C_{Q_Z}]^T$ is the drag coefficients and reference area lumped into a single damping coefficient per axis.
    The relative velocity, \(\bm{V}_{\mathcal{B}_{w}}\), is calculated as
    \begin{equation}
        \bm{V}_{\mathcal{B}_{w}} = -\bm{V}_\mathcal{B} + \bm{R}_{V} \bm{V}_w, 
    \end{equation}
    where \(\bm{V}_w\) is the wind velocity in the inertial frame.
    It is assumed the moments caused by aerodynamics are negligible and is therefore modelled as,
    \begin{equation}
        \bm{M}_\mathcal{B}^A =
        \begin{bmatrix}
            0 \\
            0 \\
            0
        \end{bmatrix}.
    \end{equation}
    
    \paragraph
    \textbf{Gravity} \newline
    Gravity applies a vertical force to the quadrotor in the inertial Down axis.
    The inertial force is transformed into the body frame with the \gls{DCM}.
    No moments are applied to the quadrotor due to gravity.
    Therefore the total force and moments acting on the quadrotor due to gravity is,
    \begin{equation}
        \bm{F}_\mathcal{B}^G = \bm{R}_V
        \begin{bmatrix}
            0 \\
            0 \\
            m_Q g
        \end{bmatrix}  \mbox{~~and~~}
        \bm{M}_\mathcal{B}^G =
        \begin{bmatrix}
            0 \\
            0 \\
            0
        \end{bmatrix}.
    \end{equation}

    \paragraph
    \textbf{Suspended payload} \newline
    The suspended payload applies a reaction force, $\bm{F}_\mathcal{B}^P$, and moment, $\bm{M}_\mathcal{B}^P$, to the quadrotor which is dependant on the equations of motion of the suspended payload.
    The payload and cable also experience gravity and aerodynamic forces which influence its motion.
    These forces and moments will all be considered in the section below.
    
\FloatBarrier\section{Suspended payload model}

    \paragraph
    The dynamical model of the quadrotor is now fully defined, except for the force and moment applied to the vehicle by the payload.
    The suspended payload can be modelled as a rigid body which is attached to the quadrotor by a rigid link.
    Hence, the movement of the quadrotor causes the suspended payload to move too.
    Due to the acceleration of the payload, the payload applies a reaction force to the quadrotor through the link.
    The equations of motion of the suspended payload need to be derived to determine these reaction forces and complete the dynamical model of the quadrotor-payload system.
    
    \paragraph
    In this section, the payload model and modelling assumptions will firstly be discussed.
    Thereafter, the payload equations of motions will be derived with Lagrangian mechanics.
    Finally, the forces acting on the quadrotor due to the payload will be determined.

    \paragraph
    Figure~\ref{fig:quad_payload} illustrates a quadrotor with a suspended payload, where
    $m_p$ is the mass of the payload, and
    $l$ is the length of the suspended cable.
    The $x$-axis and $y$-axis Euler-ZYX angles in the inertial frame are denoted by $\theta_p$ and $\phi_p$ respectively.
    Furthermore, $\bm{r}_Q = [x_Q~~y_Q~~z_Q]^T$ defines the position of the quadrotor \gls{CoM} in the inertial frame.
    Likewise, $\bm{r}_p = [x_p~~y_p~~z_p]^T$ defines the position of the payload in the inertial frame.

    \begin{figure}[!htbp]
        \centering
        \includegraphics[width=0.7\linewidth]{modelling/fig/quad_payload_model}
        \caption{Schematic of a quadrotor with suspended payload from \cite{Slabber2020}}
        \label{fig:quad_payload}
    \end{figure}
    
    \FloatBarrier\subsection{Payload assumptions}

        \paragraph
        The following major assumptions are made regarding the payload model:
        \begin{itemize}
            \item The payload is a point mass.
            \item The link is massless.
            \item The link is rigid.
            \item The link is attached to the \gls{CoM} of the multirotor.
        \end{itemize}

        \paragraph
        The payloads used in the practical setup and described in Chapter~\ref{chap:exp_design}, 
        are small relative to the quadrotor and the attachment point is close to the payload \gls{CoM}.
        They are attached with a low-friction swivel to the suspended cable, therefore the rotation of the payload around the cable axis has a negligible effect on the quadrotor. 
        Therefore modelling the payload as a point mass appears to be reasonable approximation.

        \paragraph
        The cables used in Chapter~\ref{chap:exp_design} have a low mass in comparison to the payloads and have a negligible amount of stretch.
        Furthermore, the cable remains straight and rigid during flight due to the tension applied by the payload.
        Aggressive manoeuvres may cause periods of zero cable tension where the load is in free-fall and the cable is slack \cite{Tang2015}.
        However, such aggressive manoeuvres will not be considered in this work and the assumption of a rigid, massless cable appears reasonable.

        \paragraph
        In the practical setup shown in Chapter~\ref{chap:exp_design}, the cable attachment appears to be near to the \gls{CoM} of the quadrotor.
        It is assumed that even if the attachment point is slightly below the actual \gls{CoM}, this will have a negligible effect on the dynamics and will still be approximated by a \gls{CoM} attachment.
        Due to this assumption, the payload cannot apply a moment to quadrotor, hence the quadrotor attitude dynamics is decoupled from the payload dynamics.
        Therefore, the quadrotor can be modelled as a point mass when considering the payload equations of motion.

    \FloatBarrier\subsection{Lagrangian}

        \paragraph
        Lagrangian mechanics is an energy-based modelling approach which can be used to derive differential equations describing a system \cite{Erasmus2020}.
        The dynamical equations of the same suspended payload system were derived by \cite{Slabber2020} and the derivation in this work follows parts of that approach.
        It is important to note that the derivation in this section considers the payload dynamics as a function of the motion of the quadrotor \gls{CoM}.
        The derivation starts by defining the payload position as a function of the quadrotor position in the inertial frame as,
        \begin{equation}
            \bm{r}_p = 
            \begin{bmatrix}
                x_p \\
                y_p \\
                z_p
            \end{bmatrix} = 
            \begin{bmatrix}
                x_Q + l \cos(\phi_p) \sin(\theta_p) \\
                y_Q +   \sin(\phi_p) \\
                z_Q + l \cos(\phi_p) \cos(\theta_p)
            \end{bmatrix} ,
        \end{equation}
        where $g$ is the acceleration due to gravity.
        The vector of generalised coordinates, $\bm{p}$, of the system can now be defined as,
        \begin{equation} \label{eq:general_coords}
            \bm{p} = 
            \begin{bmatrix}
                x_p \\
                y_p \\
                z_p \\
                \phi_p \\
                \theta_p
            \end{bmatrix}.
        \end{equation}

        \paragraph
        The kinetic energy, $\mathcal{T}_p$, and potential energy, $\mathcal{V}_p$, of the payload can be determined as,
        \begin{align}
            \mathcal{T}_p &= \frac{1}{2} m_p | \bm{\dot{r}}_p | ^2, \mbox{~~and~~} \\
            \mathcal{V}_p &= - m_p g z_p .
        \end{align}
        Note that these energy equations describe the system modelled as two point mass bodies and do not consider the attitude dynamics of the quadrotor as mentioned earlier.
        The Lagrangian can now be determined as,
        \begin{equation}
            \mathcal{L} = \mathcal{T}_p - \mathcal{V}_p,
        \end{equation}

    \FloatBarrier\subsection{Non-conservative forces}

        \paragraph
        The non-conservative forces and moments acting on the system are also considered in this derivation.
        This refers to the effects that add or remove energy from the considered system.
        The following non-conservative forces and moments are considered in this derivation:
        \begin{itemize}
            \item The aerodynamic drag force acting on the quadrotor.
            \item The aerodynamic drag force acting on the payload mass.
            \item The thrust generated by the quadrotor actuators.
            \item The moment caused by friction at the cable attachment point.
        \end{itemize}
        It is assumed that the cable is thin and short enough that the aerodynamic drag force acting on the cable is negligible.
        
        \paragraph
        According to the aerodynamic model presented in Equation~\ref{eq:drag_quad}, 
        the aerodynamic drag forces acting on the quadrotor and payload in the inertial frame are defined as,
        \begin{equation}
            \bm{F}_p^A = 
            \begin{bmatrix}
                F_{p_x}^A \\
                F_{p_y}^A \\
                F_{p_z}^A
            \end{bmatrix} = 
            \begin{bmatrix}
                \frac{1}{2} \phantom{.} \rho \phantom{.} C_{p} \phantom{.} \dot{x_p}^2 \\
                \frac{1}{2} \phantom{.} \rho \phantom{.} C_{p} \phantom{.} \dot{y_p}^2 \\
                \frac{1}{2} \phantom{.} \rho \phantom{.} C_{p} \phantom{.} \dot{z_p}^2
            \end{bmatrix}  \mbox{,} \label{eq:payload_drag_inertial}
        \end{equation}
        where $C_p$ is the lumped aerodynamic drag coefficient and reference area of the payload.
        It is assumed that the lumped payload drag coefficients are equal in all three axes, hence it is described by a single coefficient.

        % \paragraph
        % The actuator thrust force was derived in Equation~\ref{eq:thurst_force_moment} for the body frame.
        % This is transformed in the inertial frame with the \gls{DCM} as,
        % \begin{equation}
        %     \bm{F}_\mathcal{I}^T = \bm{R}_V^{-1} \bm{F}_\mathcal{B}^T .
        % \end{equation}

        \paragraph
        Rotational friction of the cable attachment is modelled as linear damping.
        It is assumed that the coefficient of friction is equal in each axis of rotation.
        Therefore, the friction moments opposing the $\theta_p$ and $\phi_p$ rotations are given by,
        \begin{align}
            M_{\theta_p}^F  &= - c_{\theta} \dot{\theta}_p \\
            M_{\phi_p}^F    &= - c_{\theta} \dot{\phi}_p
        \end{align}
        respectively, where $c_{\theta}$ is the rotational friction coefficient for $\theta_p$ and $\phi_p$ rotations.

        \paragraph
        A vector of non-conservative forces and moments corresponding to the system coordinates in $\bm{p}$ can now be defined as,
        \begin{equation}
            \bm{Q} = 
            \begin{bmatrix*}[c]
                - F_{p_x}^A \\
                - F_{p_y}^A \\
                - F_{p_z}^A \\
                M_{\theta_p}^F - F_{p_y}^A \cos{\phi}_p \\
                M_{\phi_p}^F - F_{p_x}^A \cos{\theta}_p
            \end{bmatrix*}.
        \end{equation}

        % ?? Check of dit reg is. Dalk nie conservative forces of quadrotor nie

        % ?? Check element wise multiplication equations

    \FloatBarrier\subsection{Equations of motion}
    
        \paragraph
        The set of Euler-Lagrange equations for this system are described by,
        \begin{equation}
            \frac{d}{dt}\left(\frac{\partial\mathcal{L}}{\partial\dot{p_j}}\right) - \frac{\partial\mathcal{L} }{\partial p_j} = Q_j,
        \end{equation}
        where 
        $p_j$ is an element in $\bm{p}$,
        $Q_j$ is the corresponding element in $\bm{Q}$,  and
        $j = \{1,~2,~3,~4,~5\}$.
        This set of coupled equations was solved with the Symbolic Maths Toolbox\texttrademark~\cite{SymbolicToolbox2021} in MATLAB to determine the payload equations of motions. 
        This yields a set of decoupled \glspl{ODE} describing the motion of the payload as a function of the motion of the quadrotor \gls{CoM}.

        % ?? Add odes in appendix
        % ?? Discuss weak link between altitude dynamics and swing angle

    \FloatBarrier\subsection{Payload forces acting on the quadrotor}



\FloatBarrier\section{Model verification} \label{sec:model_verification}

    \paragraph
    Intro

    \input{modelling/plots/prac_vs_sim_vel_step_no_payload.tex}

    \paragraph
    No load

    \input{modelling/plots/prac_vs_sim_vel_step_with_payload.tex}

    \paragraph
    With payload vel

    \input{modelling/plots/prac_vs_sim_theta_with_payload.tex}

    \paragraph
    With payload theta



    \begin{enumerate}
        \item Plot velocity step
        \item Plot position step
    \end{enumerate}

\FloatBarrier\section{Linearised model}
    \label{sec:linear_model}

\FloatBarrier\section{Dynamic payloads}

    In this work, a dynamic payload refers to a payload with dynamics that differ significantly from a rigid mass.
    When considering suspended payloads, a dynamic payload induces dynamics which differ from that of a simple pendulum.

    \begin{itemize}
        \item Most control in literature model payload as rigid Mass. Give references.
        \item Some add spring stiffness of cable (give references e.g. QuadLoad ElasticCable Prasanth Kotaru)
        \item but not practical because can design which cable you used. Cannot design which payload needs to be transported
        \item water looks like double payload
    \end{itemize}
% https://hybrid-robotics.berkeley.edu/publications/ACC2017_QuadLoad_ElasticCable.pdf), 
% https://www.researchgate.net/publication/352394086_A_Hybrid_Control_Approach_for_the_Sw[…]=publicationTitle&_iepl%5BtargetEntityId%5D=PB%3A352394086

}

