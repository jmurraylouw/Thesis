\graphicspath{{results/fig/}}

\chapter{Implementation and results}
\label{chap:results}

    \section{Parameter estimation with practical data}
        \subsection{Mass estimation}
        \subsection{Simple payload cable length estimation}
        \subsection{Complex payload cable length estimation}

    \section{Data-driven system identification with practical data}

        \FloatBarrier\subsection{Methodology}
            \begin{itemize}
                \item Method for generating data
                \item Plot example of training data
                \item picture of practical flight single and double
                \item Discuss difference between SITL and prac
                \begin{itemize}
                    \item Noise 
                    \item wind
                    \item CoM
                \end{itemize}
                \item plot hover of prac vs SITL to show noise and disturbance
            \end{itemize}

            \paragraph
            In Chapter~\ref{chap:system_id} it was noted that the optimal length of training data 
            often only included 2 velocity steps responses.
            This means the models were trained on a very small sample of step sizes 
            and need to extrapolate the dynamics of other step sizes.
        
            
        \FloatBarrier\subsection{Length of training data}
            plot NMAE vs Ttrain
            \begin{itemize}
                \item Plot strong wind vs less wind vs no wind
                \item HAVOK vs DMD
                \item Plot single pend vs double pend
            \end{itemize}

            \input{results/plots/havok_vs_dmd_Ttrain_2mps.tex}
            \input{results/plots/wind_Ttrain.tex}

        \FloatBarrier\subsection{Hyperparameters}
            plot NMAE vs q

            \input{results/plots/havok_vs_dmd_q_2mps.tex}
            \input{results/plots/prac_singular_values.tex}

            Difference between SITl and practical (same input steps)
            This is due to wind disturbance
            Plot wind vs less wind vs no wind
            
        \FloatBarrier\subsection{System parameters}

            \paragraph
            The proposed data-driven techniques work for a range of different
        Show that practical data works for different system parameters

        \paragraph
        Plot NMAE vs Ttrain - 1 graph
        \begin{itemize}
            \item m = 0.2 kg    l = 1 m  
            \item m = 0.2 kg    l = 2 m
            \item l = 1 m       m = 0.3 kg
            \item l = 1 m       m = 0.1 kg
        \end{itemize}

        \FloatBarrier\subsection{Predictions}
        \begin{itemize}
            \item Single pendulum: Plot 4 in grid showing good and bad
            \item Double pendulum: Plot 4 in grid showing good and bad
        \end{itemize}

        \FloatBarrier\subsection{Extended dimensions}
        \begin{itemize}
            \item plot error vs T-train for XY
            \item plot predictions
            \item plot error vs T-train for XYZ
        \end{itemize}
            
    \section{Swing damping control systems}

        \paragraph
        After the system identification phase, active swing damping control can be applied
        to the quadrotor and payload system.
        The control architectures are summarised in Table~\ref{tbl:controller_summary} 
        by pairing the system identification techniques along with the appropriate controllers.
        It was firstly shown in Chapter~\ref{chap:system_id} that the system identifcation techniques worked in simulation.
        Emphasise that control is now applied in full SITL simulation.

        \paragraph
        MATLAB is used to generate a MPC ROS node 
        This ROS node receives state feedback from the Gazebo simulator,
        computes the optimal control action,
        and send the setpoint to PX4 through the package 'mavros'.

        \begin{table}[!h]
            \renewcommand{\arraystretch}{1.1}
            \centering
            \caption{Summary of the system identification techniques paired with the active damping controllers.}
            \begin{tabularx}{0.75\linewidth}{@{}lll@{}}
                \toprule
                \multicolumn{2}{c}{\textbf{System identification}}   & \textbf{Controller} \\
                \cmidrule(lr){1-2}
                Category    & Algorithm                     & \\
                \midrule
                White-box   & RLS mass estimator, and       & LQR \\
                            & FFT cable length estimator    & \\
                Black-box   & DMDc, or                      & MPC \\
                            & HAVOK                         & \\
                \bottomrule
            \end{tabularx}
            \label{tbl:controller_summary}
        \end{table}
        

        \FloatBarrier\subsection{Single pendulum}

            \begin{itemize}
                \item subplot prediction of data driven model. subplot prediction of white-box model
                \item plot MPC vs LQR v PID (no wind) step = 1 m/s
                \item plot MPC vs LQR v PID (no wind) step = 2 m/s
                \item plot DMDc vs HAVOK (DMD - Havok)
                \item plot with wind disturbacne control
            \end{itemize}

        \FloatBarrier\subsection{Double pendulum}

            \begin{itemize}
                \item subplot prediction of data driven model. subplot prediction of white-box model
                \item plot MPC vs LQR v PID (no wind)
                \item plot DMDc vs HAVOK (DMD - Havok)
            \end{itemize}

    \section{HIL}

    \section{Conclusion}


