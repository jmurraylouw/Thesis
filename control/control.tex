\graphicspath{{control/fig/}}

\chapter{Control systems}
\label{chap:control}

    \FloatBarrier\section{Overview of controllers}

        \begin{table}[!h]
            \renewcommand{\arraystretch}{1.1}
            \centering
            \caption{Summary of the system identification techniques paired with the active damping controllers.}
            \begin{tabularx}{0.75\linewidth}{@{}lll@{}}
                \toprule
                \multicolumn{2}{c}{\textbf{System identification}}   & \textbf{Controller} \\
                \cmidrule(lr){1-2}
                Category    & Algorithm                     & \\
                \midrule
                White-box   & RLS mass estimator, and       & LQR \\
                            & FFT cable length estimator    & \\
                Black-box   & DMDc, or                      & MPC \\
                            & HAVOK                         & \\
                \bottomrule
            \end{tabularx}
            \label{tbl:controller_summary}
        \end{table}
    

    \FloatBarrier\section{Cascaded PID}

        Control system design
        Slower for less swing angles

    \FloatBarrier\section{LQR}

        Anton and Francois stuff

    \FloatBarrier\section{MPC}

        MATLAB
        QP solver
        C+ generation

    \FloatBarrier\section{Implentation and results}

        \paragraph
        After the system identification phase, active swing damping control can be applied
        to the multirotor and payload system.
        The control architectures are summarised in Table~\ref{tbl:controller_summary} 
        by pairing the system identification techniques along with the appropriate controllers.
        It was firstly shown in Chapter~\ref{chap:system_id} that the system identifcation techniques worked in simulation.
        % Emphasise that control is now applied in a full \gls{SITL} simulation.
        
        \FloatBarrier\subsection{Simple suspended payload}

            \paragraph
            intro

            \input{control/plots/compare_control_vel.tex}

            \paragraph
            vel control

            MPC:
            vel weight = 2;
            theta weight = 0;
            dtheta weight = 10; 
            mv weight = 1;
            mvrate weight = 5;
            Ty = 5;
            Tu = 3;

            LQR:
            LQR.Q = diag([10 10 0 100]); 
            LQR.R = 8

            \input{control/plots/compare_control_theta.tex}

            \paragraph
            theta control

            \input{control/plots/compare_control_acc_sp.tex}

            \paragraph
            acc-sp plot

            \input{control/plots/compare_control_vel_wind_disturbance.tex}

            \paragraph
            Wind disturbance wind speed~=~\SI{2}{\metre/\second}

            \input{control/plots/improve_lqr_integrator.tex}

            \paragraph
            Improve integrator

            \begin{figure}
                \captionsetup[subfigure]{justification=centering}
                \centering  
                \input{control/plots/compare_control_vel_l-1.0_mp-0.2.tex} % subfigure
                \input{control/plots/compare_control_vel_l-1.0_mp-0.2.tex} % subfigure
                \input{control/plots/compare_control_vel_l-1.0_mp-0.2.tex} % subfigure
                \caption{}
                \label{fig:compare_control_different_payloads}  
            \end{figure}

            \paragraph
            Different payloads, compare tuning

            \begin{itemize}
                \item plot acc-sp
                \item plot \gls{MPC} vs \gls{LQR} v \gls{PID} (no wind) step = 2 m/s
                \item plot different system paramaters
                \item plot with wind disturbacne control
            \end{itemize}

        \FloatBarrier\subsection{Dynamic payload}

            \paragraph
            Intro

            \input{control/plots/compare_control_vel_dynamic.tex}

            \paragraph
            vel control

            \input{control/plots/compare_control_theta_dynamic.tex}

            \paragraph
            theta control

            \begin{itemize}
                \item subplot prediction of data driven model. subplot prediction of white-box model
                \item plot \gls{MPC} vs \gls{LQR} v \gls{PID} (no wind)
            \end{itemize}

    \FloatBarrier\section{Conclusion}
    